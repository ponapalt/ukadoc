// Generated by CoffeeScript 1.8.0
var AllSiteSearch, argv, db, db_file, fs, options, query_elements, result, results, targets, _i, _j, _len, _len1, _ref;

fs = require('fs');

argv = require('argv');

AllSiteSearch = require('./all-site-search');

argv.option([
  {
    name: 'db',
    short: 'd',
    type: 'path',
    description: '使用するデータベースファイル(デフォルトは"assdb.json")'
  }
]);

argv.info('Usage: ass [options] search terms\n\n全文検索インデックスを使って全文検索をする。');

_ref = argv.run(), targets = _ref.targets, options = _ref.options;

if (!targets.length) {
  argv.help();
  process.exit(0);
}

db_file = options.db != null ? options.db : 'assdb.json';

db = JSON.parse(fs.readFileSync(db_file, 'utf8'));

AllSiteSearch.load(db);

query_elements = [];

for (_i = 0, _len = targets.length; _i < _len; _i++) {
  argv = targets[_i];
  query_elements = query_elements.concat(argv.split(/\s+/));
}

results = AllSiteSearch.search(query_elements);

for (_j = 0, _len1 = results.length; _j < _len1; _j++) {
  result = results[_j];
  console.log("" + result.id + " : score=" + result.score);
}
