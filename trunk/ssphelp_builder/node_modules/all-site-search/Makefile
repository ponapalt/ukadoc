.SUFFIXES: .js .coffee

all: all-site-search.js ass-indexer.js ass.js all-site-search-ie8.js

all-site-search-ie8.js: all-site-search.js
	node -e "fs=require('fs');s=fs.readFileSync('all-site-search.js','utf8').replace(/var ([^;]*?)(, )?\blunr\b(, )?([^;]*?);/,function(str,v1,c1,c2,v2){if(!(c1||c2)){return ';'}else{return 'var '+v1+((c1&&c2)?c1:c1?'':c2)+v2+';'}});fs.writeFileSync('all-site-search-ie8.js',s)"

.coffee.js:
	coffee -cb $^
