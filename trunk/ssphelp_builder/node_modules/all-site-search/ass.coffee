fs = require 'fs'
argv = require 'argv'
AllSiteSearch = require './all-site-search'

argv.option [
	{
		name: 'db'
		short: 'd'
		type: 'path'
		description: '使用するデータベースファイル(デフォルトは"assdb.json")'
	}
]

argv.info '''
	Usage: ass [options] search terms
	
	全文検索インデックスを使って全文検索をする。
'''

{targets, options} = argv.run()

unless targets.length
	argv.help()
	process.exit 0

db_file = if options.db? then options.db else 'assdb.json'

db = JSON.parse fs.readFileSync db_file, 'utf8'
AllSiteSearch.load db

query_elements = []
for argv in targets
	query_elements = query_elements.concat argv.split /\s+/

results = AllSiteSearch.search query_elements
for result in results
	console.log "#{result.id} : score=#{result.score}"
