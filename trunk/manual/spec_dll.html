<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>UKADOC Project DLL</title>
<link rel="stylesheet" href="spec.css" />
<!--[if lt IE 9]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>
<body>
	<h1 id="page-title">DLL</h1>
	<nav class="menu-header">
		<ul>
			<li><a href="./index.html">Index</a></li>
		</ul>
		<ul>
			<li><a href="./descript_ghost.html">Ghost</a></li>
			<li><a href="./descript_shell.html">Shell</a></li>
			<li><a href="./descript_shell_surfaces.html">surfaces.txt</a></li>
			<li><a href="./descript_balloon.html">Balloon</a></li>
			<li><a href="./descript_plugin.html">Plugin</a></li>
			<li><a href="./descript_headline.html">Headline</a></li>
			<li><a href="./descript_install.html">Install</a></li>
		</ul>
		<ul>
			<li><a href="./list_shiori_event.html">SHIORI Event</a></li>
			<li><a href="./list_shiori_event_ex.html">SHIORI Event（外部）</a></li>
			<li><a href="./list_shiori_resource.html">SHIORI Resource</a></li>
			<li><a href="./list_sakura_script.html">Sakura Script</a></li>
			<li><a href="./list_propertysystem.html">Property System</a></li>
			<li><a href="./list_plugin_event.html">PLUGIN Event</a></li>
		</ul>
		<ul>
			<li>×SHIORI/3.0</li>
			<li><a href="http://www.boreas.dti.ne.jp/~sdn/saori.html">SAORI/1.0</a>（外部サイト）</li>
			<li><a href="./spec_plugin.html">PLUGIN/2.0</a></li>
			<li><a href="./spec_headline.html">HEADLINE/2.0</a></li>
			<li><a href="./spec_dll.html">DLL</a></li>
		</ul>
	</nav>
	<section class="navigation-bar">
		<h1>DLL</h1>
		<section class="navigation-category">
			<h1>DLL</h1>
			<ul>
				<li><a href="#chapter0">前書</a></li>
				<li><a href="#chapter1">エクスポート関数群</a></li>
			</ul>
		</section>
	</section>
	<div class="text">
		<div class="caption">
			<p>最終変更：<time>2013-08-27</time></p>
		</div>
		<section id="chapter0">
			<h1>前書</h1>
			<p>ここでは、SHIORI、SAORI、MAKOTO、PLUGIN、HEADLINE等各サブシステムのコアとなる、DLLファイルに要求される仕様をまとめています。</p>
		</section>
		<section id="chapter1">
			<h1>エクスポート関数群</h1>
			<p>以下C言語での例</p>
			<ul>
				<li>extern "C" __declspec(dllexport) BOOL __cdecl load(HGLOBAL h, long len);</li>
				<li>extern "C" __declspec(dllexport) BOOL __cdecl unload(void);</li>
				<li>extern "C" __declspec(dllexport) HGLOBAL __cdecl request(HGLOBAL h, long *len);</li>
			</ul>
			<p>☆Borland系C/C++コンパイラでは_loadのように頭にアンダースコアがつくようですがそちらにも対応した方が良いでしょう。</p>
			<section>
				<h1>load</h1>
				<p>読み込み時にコールされます。HGLOBALにDLLの入るディレクトリのパスが入ります。<br />GlobalAlloc(GMEM_FIXED,xxx) されたものなのでそのままポインタ(char *)にキャストして利用してください。<br />また、必ずDLL側でGlobalFreeしてください。</p>
				<p>返り値は常にtrueです。<br />規定ではロード失敗時にfalseですが、falseを返しても何も処理されません。</p>
			</section>
			<section>
				<h1>unload</h1>
				<p>DLL開放直前（＝SSP/CROW終了時＋上書きインストール時、DLL_PROCESS_DETACH前）にコールされます。</p>
				<p>返り値は常にtrueです。<br />規定では開放失敗時にfalseですが、falseを返しても無視されます。</p>
			</section>
			<section>
				<h1>request</h1>
				<p>ロード・アンロード以外の処理はすべてここで行われます。<br />注意事項はloadと同じです。</p>
				<p>返り値はこのDLLが実装するサブシステム（SHIORI,SAORI,PLUGIN,...）の種類によります。<br />レスポンス用の返り値HGLOBALも、GlobalAlloc(GMEM_FIXED,xxx)で確保されたものにしてください。</p>
			</section>
		</section>
	</div>
</body>
</html>